<!DOCTYPE HTML PUBLIC "-//W3C/DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta charset="utf-8" />
	<META HTTP-EQUIV = "Pragma" CONTENT="no-cache">
  <meta name="viewport" content="width=device-width, initial-scale=1">
	<title> Minecraft Dynamic Map - Login/Register </title>
	<link rel="icon" href="images/dynmap.ico" type="image/ico" />

	<link rel="stylesheet" type="text/css" href="css/leaflet.css?_=3.7-SNAPSHOT-1015" />
	<link rel="stylesheet" type="text/css" href="css/standalone.css?_=3.7-SNAPSHOT-1015" media="screen" />
	<link rel="stylesheet" type="text/css" href="css/dynmap_style.css?_=3.7-SNAPSHOT-1015" media="screen" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	<script type="text/javascript" src="standalone/config.js?_=3.7-SNAPSHOT-1015"></script>
	<script type="text/javascript" src="js/jquery-3.5.1.js?_=3.7-SNAPSHOT-1015"></script>
	
	<script type="text/javascript">
		$(document).ready(function() {
			var status = $('#status_message');
			if(window.location.href.indexOf('error=loginfailed') >= 0)
				$('<div/>').text('Login Failed ').appendTo(status);
			if(window.location.href.indexOf('error=verifyfailed') >= 0)
				$('<div/>').text('Password Verify Error ').appendTo(status);
			if(window.location.href.indexOf('error=registerfailed') >= 0)
				$('<div/>').text('Registration failed (bad passcode?) ').appendTo(status);
			$('form')[0].setAttribute('action', config.url.login);
			$('form')[1].setAttribute('action', config.url.register);
			document.forms['login'].elements['j_username'].focus();
		});
		
		$(function(){
            $('form[name=register]').submit(function(){
                $.post($(this).attr('action'), $(this).serialize(), function(json) {
                    if(json.result == 'success')
                    	window.location = 'index.html';
                    else
                    	window.location = 'login.html?error=' + json.result;
                }, 'json');
                return false;
            });
        });

		$(function(){
            $('form[name=login]').submit(function(){
                $.post($(this).attr('action'), $(this).serialize(), function(json) {
                    if(json.result == 'success')
                    	window.location = 'index.html';
                    else
                    	window.location = 'login.html?error=' + json.result;
                }, 'json');
                return false;
            });
        });
	</script>
	
</head>
<body>
<div class='dynmaplogin'>
  <div class="container">
    <h3 class="">Minecraft Dynamic Map</h3>
    <div id="status_message" class="statusmessage"></div>

    <div class="loginregister">
      <div class="login" id="login-form">
        <h2>Login<span>.</span></h2>

        <p>Need an account? <a href="#register-form">Register a new user</a></p>
        <form method="post" name="login" action="up/login">
          <div class="form-item">
            <label for="j_username">Username</label><input type="text" size="20" name="j_username" id="j_username" placeholder="Enter username">
          </div>
          <div class="form-item">
            <label for="j_password">Password</label><input type="password" size="20" name="j_password" id="j_password" placeholder="Enter password">
          </div>
          <input type="submit" name="login" value="Login">
        </form>
      </div>

      <div class="register" id="register-form">
        <h2>Register New User<span>.</span></h2>

        <p>Already have an account? <a href="#login-form">Log in</a></p>
        <form method="post" name="register" action="up/register">
          <p>Run <code>/dynmap webregister [username]</code> enter your username and password, followed by the registration code</p>
          <div class="form-item">
            <label for="j_username">Username</label><input type="text" size="20" name="j_username" id="j_username" placeholder="Enter username">
          </div>
          <div class="form-item shortened">
            <label for="j_password">Password</label><input type="password" size="20" name="j_password" id="j_password" placeholder="Enter password">
          </div>
          <div class="form-item shortened">
            <label for="j_verify_password">Verify password</label><input type="password" size="20" name="j_verify_password" id="j_verify_password" placeholder="Re-enter password">
          </div>
          <div class="form-item">
            <label for="j_passcode">Registration code</label><input type="password" size="20" name="j_passcode" id="j_passcode" placeholder="Enter registration code">
          </div>
          <input type="submit" name="register" value="Register">
        </form>
      </div>
    </div>
  
  </div>
</div>

</body>
</html>
